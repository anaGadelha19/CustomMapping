<?php
$this->headLink()->appendStylesheet($this->assetUrl('node_modules/leaflet/dist/leaflet.css', 'CustomMapping'));
$this->headLink()->appendStylesheet($this->assetUrl('node_modules/leaflet-draw/dist/leaflet.draw.css', 'CustomMapping'));
$this->headLink()->appendStylesheet($this->assetUrl('node_modules/leaflet-geosearch/dist/geosearch.css', 'CustomMapping'));
$this->headLink()->appendStylesheet($this->assetUrl('node_modules/leaflet.fullscreen/Control.FullScreen.css', 'CustomMapping'));

$this->headScript()->appendFile($this->assetUrl('node_modules/leaflet/dist/leaflet.js', 'CustomMapping'));
$this->headScript()->appendFile($this->assetUrl('node_modules/leaflet-draw/dist/leaflet.draw.js', 'CustomMapping'));
$this->headScript()->appendFile($this->assetUrl('node_modules/leaflet-providers/leaflet-providers.js', 'CustomMapping'));
$this->headScript()->appendFile($this->assetUrl('node_modules/leaflet-geosearch/dist/bundle.min.js', 'CustomMapping'));
$this->headScript()->appendFile($this->assetUrl('node_modules/leaflet.fullscreen/Control.FullScreen.js', 'CustomMapping'));

// JS files loaded here
$this->headScript()->appendFile($this->assetUrl('js/mapping-form.js', 'CustomMapping')); // Where markers and popup are created
$this->headScript()->appendFile($this->assetUrl('js/control.opacity.js', 'CustomMapping'));
$this->headScript()->appendFile($this->assetUrl('js/control.fit-bounds.js', 'CustomMapping'));
$this->headScript()->appendFile($this->assetUrl('js/control.default-view.js', 'CustomMapping'));


// css files loaded here
$this->headLink()->appendStylesheet(
    $this->assetUrl('css/mapping.css', 'CustomMapping')
);

$mapping = null;
$features = [];
$itemMedia = [];
if (isset($item)) {
    $mapping = $this->api()->searchOne('custom_mappings', ['item_id' => $item->id()])->getContent();
    $features = $this->api()->search('custom_mapping_features', ['item_id' => $item->id()])->getContent();
    $itemMedia = $item->media();
}
?>

<fieldset id="mapping-section" class="section">
    <legend id="mapping-legend"><?php echo $this->translate('Mapping'); ?></legend>
    <div id="mapping-map" style="height:700px;"
        data-mapping="<?php echo $this->escapeHtml(json_encode($mapping)); ?>"
        data-features="<?php echo $this->escapeHtml(json_encode($features)); ?>"
    ></div>
    
    
    <div id="mapping-feature-editor" class="sidebar" >
        <a href="#" class="sidebar-close o-icon-close"><span class="screen-reader-text"><?php echo $this->translate('Close Me'); ?></span></a>
        <h3><?php echo $this->translate('Marker Details'); ?></h3>
        
        <div class='gap'>   
                <div><?php echo $this->translate('Title'); ?></div>
                <input type="text" class="mapping-feature-label" size="30">
        </div>

        <div class='gap'>
                    <div><?php echo $this->translate('Description'); ?></div>
                <textarea class="mapping-feature-description" rows="4" cols="30"></textarea>
        </div>

        <div class='gap'>
                <select class="mapping-feature-type">
                    <option value=""> Select type </option>
                    <option value="event">Event</option>
                    <option value="place">Place</option>
                    <option value="person">Person</option>
                </select>   
        </div>

        <div class='gap'>
                <div><?php echo $this->translate('Marker color'); ?></div>
                <div class="mapping-feature-color-picker">
                    <button type="button" data-color="#db1d08" class="color-swatch red"></button>
                    <button type="button" data-color="#3498db" class="color-swatch blue"></button>
                    <button type="button" data-color="#2ecc71" class="color-swatch green"></button>
                    <button type="button" data-color="#f39c12" class="color-swatch orange"></button>
                    <button type="button" data-color="#9b59b6" class="color-swatch purple"></button>
                </div>
        </div>



        <div class="mapping-feature-popup-image"></div>
            <button class="mapping-feature-popup-image-select"><?php echo $this->translate('Select feature image'); ?></button>
        </div>
        <div id="mapping-form">
            <input type="hidden" name="o-module-mapping:mapping[o:id]">
            <input type="hidden" name="o-module-mapping:mapping[o-module-mapping:bounds]" value="">
        </div>


        <div id="mapping-feature-image-selector" class="sidebar">
            <a href="#" class="sidebar-close o-icon-close"><span class="screen-reader-text"><?php echo $this->translate('Close Me'); ?></span></a>
            <h3><?php echo $this->translate('Feature image'); ?></h3>
            <label><input type="radio" class="mapping-feature-image-select" name="feature-image" value="" checked><?php echo $this->translate(' No Image'); ?></label>
            <?php foreach ($itemMedia as $media): ?>
            <?php if ($media->hasThumbnails()): ?>
            <label style="cursor:pointer;">
                <input type="radio" class="mapping-feature-image-select" name="feature-image" style="display:none;"
                    value="<?php echo $this->escapeHtml($media->id()); ?>"
                    data-media-thumbnail-url="<?php echo $this->escapeHtml($media->thumbnailUrl('medium')); ?>"
                    data-media-title="<?php echo $this->escapeHtml($media->displayTitle()); ?>">
                <img src="<?php echo $this->escapeHtml($media->thumbnailUrl('medium')); ?>"
                    title="<?php echo $this->escapeHtml($media->displayTitle()); ?>">
            </label>
            <?php endif; ?>
            <?php endforeach; ?>
        </div>

    
</fieldset>
