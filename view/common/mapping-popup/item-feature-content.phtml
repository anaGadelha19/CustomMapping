<!-- This is what is showing inside of the popup -->
<?php
$label = $feature->label();
$description = $feature->description();
$media = $feature->media();
$item = $feature->item();
$color = $feature->markerColor();
$selectedPropertyIds = $feature->propertyIds();
$selectedFields = [];
if ($selectedPropertyIds) {
    $selectedSet = array_flip($selectedPropertyIds);
    foreach ($item->values() as $propertyData) {
        $property = $propertyData['property'];
        $propertyId = $property->id();
        if (!isset($selectedSet[$propertyId])) {
            continue;
        }
        $valueTexts = [];
        foreach ($propertyData['values'] as $value) {
            $text = null;
            if ($value->valueResource()) {
                $text = $value->valueResource()->displayTitle();
            } else {
                $text = $value->value();
            }
            if (is_string($text) && trim($text) !== '') {
                $valueTexts[] = $text;
            }
        }
        if ($valueTexts) {
            $selectedFields[] = [
                'label' => $property->label(),
                'values' => $valueTexts,
            ];
        }
    }
}
?>
<span class="group-type" style="<?php echo $color ? 'color:' . $this->escapeHtmlAttr($color) : ''; ?>">

    <h2 class="sidebar-title">
        <?php echo ($label) ? $this->escapeHtml($label) : $this->translate('Item'); ?>
    </h2>

</span>

<span class="group-value">

    <!-- <?php echo $item->link($item->displayTitle(null, $this->lang()), null, ['target' => '_blank']); ?> -->

    <?php if ($media): ?>
        <?php echo $this->thumbnail($media, 'medium'); ?>
    <?php endif; ?>

    <?php if (!empty($description)): ?>
        <p class="sidebar-description">
            <?php echo $this->escapeHtml($description); ?>
        </p>
    <?php endif; ?>

    <?php if (!empty($selectedFields)): ?>
        <dl class="mapping-feature-item-values">
            <?php foreach ($selectedFields as $field): ?>
                <div class="mapping-feature-item-values-row">
                    <dt><?php echo $this->escapeHtml($field['label']); ?></dt>
                    <dd><?php echo $this->escapeHtml(implode('; ', $field['values'])); ?></dd>
                </div>
            <?php endforeach; ?>
        </dl>
    <?php endif; ?>

</span>